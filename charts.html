<!DOCTYPE html>
<html lang="en"><head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title>Opioid Atlas</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="yeti_files/bootstrap.css" media="screen">
    <link rel="stylesheet" href="yeti_files/custom.css">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
	<script src="../bower_components/html5shiv/dist/html5shiv.js"></script>
	<script src="../bower_components/respond/dest/respond.min.js"></script>
	<![endif]-->
    <script src="yeti_files/ga.js" async="" type="text/javascript"></script>
    <script>

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-23019901-1']);
      _gaq.push(['_setDomainName', "bootswatch.com"]);
      _gaq.push(['_setAllowLinker', true]);
      _gaq.push(['_trackPageview']);

      (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>

    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.js"></script>

    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/1.8.0/d3-legend.min.js"></script>
    <script src="http://d3js.org/topojson.v1.min.js"></script>
    <link href="assets/css/axis.css" rel="stylesheet">
    <link href="assets/css/select.css" rel="stylesheet">
    <link href="assets/css/range.css" rel="stylesheet">
    <link href="assets/css/path.css" rel="stylesheet">

    <script src="assets/js/countries.js"></script>
    <script src="assets/js/incb.js"></script>
    <script src="assets/js/incb_histo.js"></script>
    <script src="assets/js/incbMDS.js"></script>
    <script src="assets/js/incb_local_reg.js"></script>
    <script src="assets/js/incb_histo_levels.js"></script>

    <script src="assets/js/data.js"></script>
    <script src="assets/js/histo.js"></script>
    <script src="assets/js/hover.js"></script>
    <script src="assets/js/lines.js"></script>
    <script src="assets/js/map.js"></script>
    <script src="assets/js/mds.js"></script>
    <script src="assets/js/scales.js"></script>
    <script src="assets/js/scatter.js"></script>
    <script src="assets/js/table.js"></script>
    <script src="assets/js/text.js"></script>
    <script src="assets/js/ts.js"></script>
    <script src="assets/js/webpage.js"></script>
  </head>

  <body>
    <div class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <a href="index.html" class="navbar-brand">Opioid Atlas</a>
          <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        </div>
        <div class="navbar-collapse collapse" id="navbar-main">
          <ul class="nav navbar-nav">
            <li><a href="index.html">Home</a></li>
            <li><a href="#opioidmap">Opioid Map</a></li>
            <li><a href="#region">Regional Trends</a></li>
            <li><a href="#cogs">Summary Statistics</a></li>
          </ul>

          <ul class="nav navbar-nav navbar-right">
            <li><a href="methods.html" target="_blank">Methods</a></li>
            <li><a href="data.html" target="_blank">Data Sources</a></li>
            <li><a href="https://docs.google.com/forms/d/1Zu2eqymBuezwb7vvnm5fwZy-Vp91ipwR4CshEPK_RIs/viewform" target="_blank">Feedback Form</a></li>
          </ul>

        </div>
      </div>
    </div>

    <div id="opioidmap" class="container">
      <div class="page-header" id="banner">
        <div class="row">
          <div class="col-lg-12">
            <h1>Opioid Map</h1>
            <h2>Explore country-level consumption trends by opioid class and year</h2>
            <p class="text-muted">  Explore country-level consumption trends by hovering over different geographic location in the Opioid Map. Use the dropdown menu to select specific opioids and the year slider to visualize global consumption patterns for a given year. All opioid consumption levels are reported in morphine-equivalent milligrams per person and the calculation is described on our <a href="methods.html">Methods page</a>.</p>
	         <br>
          </div>
        </div>
        <div class="row">
	    <!-- Chart 1========================== -->
	    <div class="col-lg-2">
	      <form id="mapSelect" class="well" style="width:150px">
      		<label id="mapDrugInput">Opioid<br><select class="chzn-select" id="drugSelect" style="width:110px"></select></label>
      		<label id="mapYearInput"><text>Year: 1989</text><input type="range" min="1989" max="2013" value="1989" id="mapSlider", oninput="updateMapColors()" style="width:120px"></label>
      	      </form>
  	    </div>
    	    <div id="map" class="col-lg-10">
    	    </div>
	</div>
  	<br>
  	    <div id ="region" class="container">
  	      <hr>
  	      <br>
	      <h1>Regional Trends</h1>
  	      <h2>Visualize longitudional trends in opioid cosumption by country or region.</h2>
  	      <p class="text-muted"> Use the options on the left of the chart to visualize trends by country and opiate type. Move your mouse over a trend line or country name to highlight the series and print the full country name. All country names are abbreviated using standard <a href="https://en.wikipedia.org/wiki/ISO_3166-1_alpha-3#Current_codes">three letter country  codes</a>.  The y-axis is cube-root scaled, so that differences at small scales are not dominated by those at larger ones.</p>

	      <div class="row">
		<div class="col-lg-2">
		  <form id="tsSelect" class="well">
		    <label> Opioid
		      <br>
    		      <select class="chzn-select" multiple="true" id="drugSelect"></select>
		    </label>
		    <label>
		      Region
		      <br>
    		      <select class="chzn-select" multiple="true" id="regionSelect"></select>
		    </label>
		  </form>
		</div>
  		<div class="col-lg-10" id="tsRegions">
		</div>
  	      </div>
	    </div>
	    <br>
	    
	    <div id = "cogs" class="container">
  	      <hr>
  	      <br>
    	      <div class="row">
      		<div class="col-lg-12">
        	  <div class="bs-component">	
		    <h1>Statistical Summaries</h1>
  		    <p class="text-muted"> While helpful for reviewing the raw data, the map and time series plots above aren’t well-suited to answering a few simple questions we had about the data: What are overall trends in consumption across drugs and countries? Are there substantial deviations? Are there groups of countries with very similar consumption patterns? The map makes comparisons across time and drugs difficult, while the looking at too many time series at once can obscure interesting variation. To more systematically explore these questions, we calculated different summary statistics and plotted them in the three figures below. See Methods [todo: link] for details on how these summaries were computed. </p>

  		    <h2>Descriptive Statistics Histogram</h2>
  		    <p class="text-muted"> To visualize key consumption trends, provide continent and opiate class information in the selection box below. Then, use the dropdown to choose from alternative statistic to display in the chart on the right. </p>
          <p class="text-muted">  Each country in the continent you selected appears as a dot in the chart below. You can hover a country dot in the chart on the left to view detailed trends for the country in the chart on the right.  Country dots that appear on the same horizontal line have a similar trend.  The number of country dots on line indicates the number of countries that share the trend and the y-axis label shows the value of the summary statistic on a subset of bins. For example, when the “overall change” trend option is selected, the country dots near the top represent series that are increasing, those at the bottom are decreasing.  </p>
		  </div>
		</div>
	      </div>
	      
	      <div class="row">
  		<div class="col-lg-2" id="cogSelections">
		  <form class="well">
		    <label> Cognostic <br>
    		      <select class="chzn-select" id="cogSelect"></select>
		    </label>
		    <label> Opioid <br>
    		      <select class="chzn-select" multiple="true" id="drugSelect"></select>
		    </label>
		    <label> Region <br>
    		      <select class="chzn-select" multiple="true" id="regionSelect"></select>
		    </label>
		  </form>
		</div>
      		<div class="col-lg-5">
        	  <div class="bs-component">
		    <div class="row-fluid">
      		      <div id="cognostics"></div>
      		      <p class="text-muted">This data view helps identify the typical value of the summary statistic across all country-drug pairs, as well as outlier series that deviate strongly. </p>
   		      
  		    </div>         		 
		  </div>
       		</div>
		<div class="col-lg-5">
       		  <div class="bs-component">
		    <div class="row-fluid">
      		      <div id="cognosticsSeries"></div>
  		    </div> 
  		    <p class="text-muted">The country-drug combination you selected on the right chart will appear in the foreground. All other drugs for that country appear muted in the background.</p>
		  </div>
		</div>
	      </div>
	    </div>
  	    <br>

    	    <div class="row">
      	      <div class="col-lg-12">
		<div class="bs-component">	
		  <h2>Temporal Opioid Consumption Patterns</h2>
  		  <p class="text-muted"> Use this chart to identify countries that have rapid versus slow annual changes in consumption over time.  Each point on the left chart represents a country-drug combination at a specific time point, specified by the selection box. Points to the right represent country-drug series that have high values in a small window around the selected time. Points towards the top (bottom) represent country-drug series that are increasing (decreasing) rapidly in a window around the selected time.</p>
		</div>
	      </div>
	    </div>	

	    <div class="row">
  	      <div class="col-lg-2" id="locRegSelect">
		<form class="well">
		  <label> Opioid <br>
    		    <select class="chzn-select" multiple="true" id="drugSelect"></select>
		  </label>
		  <label> Region <br>
    		    <select class="chzn-select" multiple="true" id="regionSelect"></select>
		  </label>
      		  <label id="locRegYearInput">
		    <text>Year: 1989</text>
		    <input type="range" min="1989" max="2013" value="1989" id="locRegSlider", oninput="updateLocReg()">
      		  </label>
		</form>
  	      </div>
      	      <div class="col-lg-5">
		<div class="bs-component">
   		  <div class="row-fluid">
      		    <div id="locRegScatter"></div>
          	    <p class="text-muted">Hover over a country to show its full time series in the chart on the right. </p>
  		  </div>         		 
		</div>
       	      </div>
	      <div class="col-lg-5">
       		<div class="bs-component">
		  <div class="row-fluid">
      		    <div id="locRegSeries"></div>
		    <p class="text-muted">The country you choose on the left appears here. All other drugs for that country appear muted in the background.</p>
  		  </div> 
		</div>
	      </div>
	    </div>		

	    </div>
    	 <div class="row">
       	 <div class="col-lg-12">
              <div class="bs-component">	
		<h2>Opioid Consumption Clusters</h2>
  		<p class="text-muted"> Based on their opiate consumption data, the chart below uses a statistical method, called multidimensional scaling (MDS), to visualize the level of similarity between countries in the same continent, or among multiple continents. Countries that have similar consumption appear closer together on the chart below. To visualize opiate consumption "clusters" in the chart on the left, indicate continent and opioid classes information in the selection box below. </p>
	            </div>
	       </div>
	  </div>			

	<div class="row">
  	  <div class="col-lg-2" id="mdsSelect">
	    <form class="well">
	      <label> Opioid <br>
    		<select class="chzn-select" multiple="true" id="drugSelect"></select>
	      </label>
	      <label> Region <br>
    		<select class="chzn-select" multiple="true" id="regionSelect"></select>
	      </label>
	    </form>
  	  </div>
      	  <div class="col-lg-5">
            <div class="bs-component">
      	      <div id="mdsScatter"></div>
              <p class="text-muted">Hover over a country to display more detailed country and continent-level trends in chart on the right side. </p>
       	  	</div>
       	  </div>
	  			<div class="col-lg-5">
       	    <div class="bs-component">
      	      <div id="mdsSeries"></div>
              <p class="text-muted">The country you selected on the right chart will appear in the foreground. All other drugs for that country appear muted in the background.</p>
	    			</div>
	    		</div>
  </div>


      <br>
      <hr>

      <footer>
	<div class="row">
	  <div class="col-lg-12">
	    <p>Made by <a href="http://stanford.edu/group/stats-for-good/" rel="nofollow">Stanford Stats for Good</a> in collaboration with <a href="http://globalonc.org/">Global Oncology Initiative (GO!)</a>.</p>
	    <p>Code can be downloaded from our <a href="https://github.com/krisrs1128/OpioidAtlas">GitHub repository</a> and is released under the MIT License</a>.</p>

	    
	  </div>
	</div>

      </footer>

    </div>

<script type="text/javascript">
  // draw for the first time
  const map = $("#map");
  const ts = $("#ts");
  const tsRegions = $("#tsRegions");
  const cognostics = $("#cognostics");
  const mds = $("#mdsScatter");
  const mdsSeries = $("#mdsSeries");
  const locReg = $("#locRegScatter");
  const locRegSeries = $("#locRegSeries");

  setupSVG("#mdsScatter", .95 * mds.width(), .6 * mds.width(), "#F7F7F7");
  setupSVG("#mdsSeries", .95 * mdsSeries.width(), .6 * mdsSeries.width(), "#F7F7F7");

  setupSVG("#locRegScatter", .95 * locReg.width(), .6 * locReg.width(), "#F7F7F7");
  setupSVG("#locRegSeries", .95 * locRegSeries.width(), .6 * locRegSeries.width(), "#F7F7F7");

  setupMapVis(incb, countries, map.width(), .35 * map.width());
  setupSVG("#tsRegions", tsRegions.width(), 0.4 * tsRegions.width(), "#F7F7F7");
  setupSVG("#cognostics", cognostics.width(), 0.6 * cognostics.width(), "#F7F7F7");
  setupSVG("#cognosticsSeries", cognostics.width(), 0.6 * cognostics.width(), "#F7F7F7");

  // add selections for map
  allDrugs = ["total", "codeine", "fentanyl", "hydrocodone", "morphine", "oxycodone",  "pethidine"];
  fillOptions("#mapSelect #drugSelect", allDrugs, false);
  $("#mapSelect #drugSelect").on("change", updateMapColors);

  // draw the map
  updateMapColors();

  // add selections for trends
  allSubregions = ['Afghanistan','Albania','Algeria','Angola','Argentina','Armenia','Australia','Austria','Azerbaijan','Bahamas','Bahrain','Bangladesh','Barbados','Belarus','Belgium','Belize','Benin','Bhutan','Bolivia','Bosnia and Herz.','Botswana','Brazil','Brunei','Bulgaria','Burkina Faso','Myanmar','Burundi','Cambodia','Cameroon','Canada','Cape Verde','Central African Rep.','Chad','Chile','China','Colombia','Comoros','Congo','Costa Rica','Croatia','Cuba','Cyprus','Czech Rep.','Dem. Rep. Congo','Denmark','Djibouti','Dominican Rep.','Ecuador','Egypt','El Salvador','Eq. Guinea','Eritrea','Estonia','Ethiopia','Fiji','Finland','France','Fr. Polynesia','Gabon','Gambia','Georgia','Germany','Ghana','Greece','Grenada','Guatemala','Guinea','Guinea-Bissau','Guyana','Haiti','Honduras','Hong Kong','Hungary','Iceland','India','Indonesia','Iran','Iraq','Ireland','Israel','Italy','Jamaica','Japan','Jordan','Kazakhstan','Kenya','Dem. Rep. Korea','Korea','Kyrgyzstan','Lao PDR','Latvia','Lebanon','Lesotho','Libya','Lithuania','Luxembourg','Madagascar','Malawi','Malaysia','Mali','Mauritania','Mauritius','Mexico','Mongolia','Montenegro','Morocco','Mozambique','Namibia','Nepal','Netherlands','New Caledonia','New Zealand','Nicaragua','Niger','Nigeria','Norway','Oman','Pakistan','Panama','Papua New Guinea','Paraguay','Peru','Philippines','Poland','Portugal','Qatar','Moldova','Romania','Russia','Rwanda','St. Vin. and Gren.','Samoa','S<U+00E3>o Tom<U+00E9> and Principe','Saudi Arabia','Senegal','Serbia','Sierra Leone','Singapore','Slovakia','Slovenia','Solomon Is.','South Africa','Spain','Sri Lanka','Sudan','Suriname','Swaziland','Sweden','Switzerland','Syria','Tajikistan','Thailand','Macedonia','Togo','Trinidad and Tobago','Tunisia','Turkey','Turkmenistan','Uganda','Ukraine','United Kingdom','Tanzania','United States','United Arab Emirates','Uruguay','Uzbekistan','Vanuatu','Venezuela','Vietnam','Yemen','Zambia','Zimbabwe']

      fillOptions("#tsSelect #drugSelect", allDrugs, false);
      fillOptions("#tsSelect #regionSelect", allSubregions, false);
      $("#tsSelect #drugSelect").on("change", updateShownTS)
      $("#tsSelect #regionSelect").on("change", updateShownTS);
      updateShownTS()

      // add selections for cognostics
      allRegions = ["Asia", "Africa", "Americas", "Europe", "Oceania"]
      const allCogs = ["overall change", "log(overall relative change)",
      "average 1989 - 1993", "average 1994 - 1998", "average 1999 - 2003",
      "average 2004 - 2009", "average 2009 - 2013",
      "maximum one-year increase", "maximum one-year decrease",
      "log(maximum one-year relative increase)",
      "log(maximum one-year relative decrease)"]

      fillOptions("#cogSelections #cogSelect", allCogs, false);
      fillOptions("#cogSelections #drugSelect", allDrugs, true);
      fillOptions("#cogSelections #regionSelect", allRegions, false);
      $("#cogSelections #regionSelect").on("change", updateCognostics);
      $("#cogSelections #cogSelect").on("change", updateCognostics);
      $("#cogSelections #drugSelect").on("change", updateCognostics);
      updateCognostics()

      // add selections for mds
      fillOptions("#mdsSelect #drugSelect", allDrugs, true);
      fillOptions("#mdsSelect #regionSelect", allRegions, true);
      $("#mdsSelect #drugSelect").on("change", updateMDS);
      $("#mdsSelect #regionSelect").on("change", updateMDS);
      updateMDS()

      // add selections for mds
      fillOptions("#locRegSelect #drugSelect", allDrugs, true);
      fillOptions("#locRegSelect #regionSelect", allRegions, true);
      $("#locRegSelect #drugSelect").on("change", updateLocReg);
      $("#locRegSelect #regionSelect").on("change", updateLocReg);
      updateLocReg()
</script>

<script type="text/javascript">
  // use multiselect plugin
  $(function(){
  $(".chzn-select").chosen();
  });
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.4.2/chosen.jquery.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.4.2/chosen.css">
</body>
</html>

