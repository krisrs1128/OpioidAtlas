<!DOCTYPE html>
<html lang="en"><head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title>Opioid Data Browser</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="yeti_files/bootstrap.css" media="screen">
    <link rel="stylesheet" href="yeti_files/custom.css">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
	<script src="../bower_components/html5shiv/dist/html5shiv.js"></script>
	<script src="../bower_components/respond/dest/respond.min.js"></script>
	<![endif]-->
    <script src="yeti_files/ga.js" async="" type="text/javascript"></script>
    <script>

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-23019901-1']);
      _gaq.push(['_setDomainName', "bootswatch.com"]);
      _gaq.push(['_setAllowLinker', true]);
      _gaq.push(['_trackPageview']);

      (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>

    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.js"></script>

    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/1.8.0/d3-legend.min.js"></script>
    <script src="http://d3js.org/topojson.v1.min.js"></script>
    <link href="assets/css/axis.css" rel="stylesheet">
    <link href="assets/css/select.css" rel="stylesheet">
    <link href="assets/css/range.css" rel="stylesheet">
    <link href="assets/css/path.css" rel="stylesheet">

    <script src="assets/js/countries.js"></script>
    <script src="assets/js/incb.js"></script>
    <script src="assets/js/incb_histo.js"></script>
    <script src="assets/js/incbMDS.js"></script>
    <script src="assets/js/incb_local_reg.js"></script>
    <script src="assets/js/incb_histo_levels.js"></script>

    <script src="assets/js/data.js"></script>
    <script src="assets/js/histo.js"></script>
    <script src="assets/js/hover.js"></script>
    <script src="assets/js/lines.js"></script>
    <script src="assets/js/map.js"></script>
    <script src="assets/js/mds.js"></script>
    <script src="assets/js/scales.js"></script>
    <script src="assets/js/scatter.js"></script>
    <script src="assets/js/table.js"></script>
    <script src="assets/js/text.js"></script>
    <script src="assets/js/ts.js"></script>
    <script src="assets/js/webpage.js"></script>
  </head>

  <body>
    <div class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <a href="index.html" class="navbar-brand">Opioid Data Browser</a>
          <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        </div>
        <div class="navbar-collapse collapse" id="navbar-main">
          <ul class="nav navbar-nav">
            <li><a href="index.html">Home</a></li>
            <li><a href="charts.html#opioidmap">Opioid Map</a></li>
            <li><a href="charts.html#region">Regional Trends</a></li>
            <li><a href="charts.html#cogs">Summary Statistics</a></li>
          </ul>

          <ul class="nav navbar-nav navbar-right">
            <li><a href="methods.html" target="_blank">Methods</a></li>
            <li><a href="data.html" target="_blank">Data Sources</a></li>
            <li><a href="https://docs.google.com/forms/d/1Zu2eqymBuezwb7vvnm5fwZy-Vp91ipwR4CshEPK_RIs/viewform" target="_blank">Feedback Form</a></li>
          </ul>

        </div>
      </div>
    </div>

    <div class="container">
      <div class="page-header" id="banner">
        <div class="row">
          <div class="col-lg-12">
            <h1>Methods</h1>
            <p class="text-muted">All of our preprocessing and analysis can be reproduced by running our scripts which can be found in our Github repository located <a href="https://github.com/krisrs1128/OpioidDataBrowser">here</a>. The code for generating the visualizations and site html is available <a href="https://github.com/krisrs1128/OpioidDataBrowser/tree/gh-pages">here</a>.</p>
						<p class="text-muted">In order to focus our data visualization tool on the most commonly used opiates in palliative care, at the outset, we removed several medications that seemed less relevant to palliative care; see our <a href="data.html">Data Sources page</a> to recover these fields. We then transformed each non-morphine medication to morphine equivalence, using the morphine milligram equivalent <a href="http://www.nyc.gov/html/doh/html/mental/MME.html">calculator</a> available from NYC Department of Health and Mental Hygiene.</p>
						<p class="text-muted">For each of the three figures in the statistical summaries section, we first cube-rooted the data, so that large countries did not dominate the rest. For the histogram, we added pseudocounts for the statistics involving relative change, to avoid dividing by zero. Specifically, we added 1e-3 mg per person to the numerator and denominator of the ratios.</p>
						<p class="text-muted">For the local trends, we fitted a local ridge regression for each country-drug pair. This provides a collection of slopes t for each timepoint in that series; we called this value the “local slope.” Similarly, the model provides a fitted response yt at each timepoint; we called this the “local average.”</p>
						<p class="text-muted">For the MDS, we represented each country-drug pair by the concatenation of its (cube-rooted) original series and its (cube-rooted) differenced series. A euclidean distance was used to define the distance between the resulting representations.</p>
          </div>
        </div>



      <br>
      <hr>

      <footer>
	<div class="row">
	  <div class="col-lg-12">
	    <p>Made by <a href="http://stanford.edu/group/stats-for-good/" rel="nofollow">Stanford Stats for Good</a> in collaboration with <a href="http://globalonc.org/">Global Oncology Initiative (GO!)</a>.</p>
	    <p>Code can be downloaded from our <a href="https://github.com/krisrs1128/OpioidDataBrowser">GitHub repository</a> and is released under the <a href="https://github.com">MIT License</a>.</p>

	    
	  </div>
	</div>

      </footer>

    </div>

<script type="text/javascript">
  // draw for the first time
  const map = $("#map");
  const ts = $("#ts");
  const tsRegions = $("#tsRegions");
  const cognostics = $("#cognostics");
  const mds = $("#mdsScatter");
  const mdsSeries = $("#mdsSeries");
  const locReg = $("#locRegScatter");
  const locRegSeries = $("#locRegSeries");

  setupSVG("#mdsScatter", .95 * mds.width(), .6 * mds.width(), "#F7F7F7");
  setupSVG("#mdsSeries", .95 * mdsSeries.width(), .6 * mdsSeries.width(), "#F7F7F7");

  setupSVG("#locRegScatter", .95 * locReg.width(), .6 * locReg.width(), "#F7F7F7");
  setupSVG("#locRegSeries", .95 * locRegSeries.width(), .6 * locRegSeries.width(), "#F7F7F7");

  setupMapVis(incb, countries, map.width(), .35 * map.width());
  setupSVG("#tsRegions", tsRegions.width(), 0.4 * tsRegions.width(), "#F7F7F7");
  setupSVG("#cognostics", cognostics.width(), 0.6 * cognostics.width(), "#F7F7F7");
  setupSVG("#cognosticsSeries", cognostics.width(), 0.6 * cognostics.width(), "#F7F7F7");

  // add selections for map
  allDrugs = Object.keys(incb[0].ts);
  allDrugs.shift();
  fillOptions("#mapSelect #drugSelect", allDrugs, false);
  $("#mapSelect #drugSelect").on("change", updateMapColors);

  // draw the map
  updateMapColors();

  // add selections for trends
  allSubregions = ['Afghanistan','Albania','Algeria','Angola','Argentina','Armenia','Australia','Austria','Azerbaijan','Bahamas','Bahrain','Bangladesh','Barbados','Belarus','Belgium','Belize','Benin','Bhutan','Bolivia','Bosnia and Herz.','Botswana','Brazil','Brunei','Bulgaria','Burkina Faso','Myanmar','Burundi','Cambodia','Cameroon','Canada','Cape Verde','Central African Rep.','Chad','Chile','China','Colombia','Comoros','Congo','Costa Rica','Croatia','Cuba','Cyprus','Czech Rep.','Dem. Rep. Congo','Denmark','Djibouti','Dominican Rep.','Ecuador','Egypt','El Salvador','Eq. Guinea','Eritrea','Estonia','Ethiopia','Fiji','Finland','France','Fr. Polynesia','Gabon','Gambia','Georgia','Germany','Ghana','Greece','Grenada','Guatemala','Guinea','Guinea-Bissau','Guyana','Haiti','Honduras','Hong Kong','Hungary','Iceland','India','Indonesia','Iran','Iraq','Ireland','Israel','Italy','Jamaica','Japan','Jordan','Kazakhstan','Kenya','Dem. Rep. Korea','Korea','Kyrgyzstan','Lao PDR','Latvia','Lebanon','Lesotho','Libya','Lithuania','Luxembourg','Madagascar','Malawi','Malaysia','Mali','Mauritania','Mauritius','Mexico','Mongolia','Montenegro','Morocco','Mozambique','Namibia','Nepal','Netherlands','New Caledonia','New Zealand','Nicaragua','Niger','Nigeria','Norway','Oman','Pakistan','Panama','Papua New Guinea','Paraguay','Peru','Philippines','Poland','Portugal','Qatar','Moldova','Romania','Russia','Rwanda','St. Vin. and Gren.','Samoa','S<U+00E3>o Tom<U+00E9> and Principe','Saudi Arabia','Senegal','Serbia','Sierra Leone','Singapore','Slovakia','Slovenia','Solomon Is.','South Africa','Spain','Sri Lanka','Sudan','Suriname','Swaziland','Sweden','Switzerland','Syria','Tajikistan','Thailand','Macedonia','Togo','Trinidad and Tobago','Tunisia','Turkey','Turkmenistan','Uganda','Ukraine','United Kingdom','Tanzania','United States','United Arab Emirates','Uruguay','Uzbekistan','Vanuatu','Venezuela','Vietnam','Yemen','Zambia','Zimbabwe']

      fillOptions("#tsSelect #drugSelect", allDrugs, false);
      fillOptions("#tsSelect #regionSelect", allSubregions, false);
      $("#tsSelect #drugSelect").on("change", updateShownTS)
      $("#tsSelect #regionSelect").on("change", updateShownTS);
      updateShownTS()

      // add selections for cognostics
      allRegions = ["Asia", "Africa", "Americas", "Europe", "Oceania"]
      const allCogs = incb_histo[0].map(function(d) { return d["L1"] })
      fillOptions("#cogSelections #cogSelect", allCogs, false);
      fillOptions("#cogSelections #drugSelect", allDrugs, true);
      fillOptions("#cogSelections #regionSelect", allRegions, false);
      $("#cogSelections #regionSelect").on("change", updateCognostics);
      $("#cogSelections #cogSelect").on("change", updateCognostics);
      $("#cogSelections #drugSelect").on("change", updateCognostics);
      updateCognostics()

      // add selections for mds
      fillOptions("#mdsSelect #drugSelect", allDrugs, true);
      fillOptions("#mdsSelect #regionSelect", allRegions, true);
      $("#mdsSelect #drugSelect").on("change", updateMDS);
      $("#mdsSelect #regionSelect").on("change", updateMDS);
      updateMDS()

      // add selections for mds
      fillOptions("#locRegSelect #drugSelect", allDrugs, true);
      fillOptions("#locRegSelect #regionSelect", allRegions, true);
      $("#locRegSelect #drugSelect").on("change", updateLocReg);
      $("#locRegSelect #regionSelect").on("change", updateLocReg);
      updateLocReg()
</script>

<script type="text/javascript">
  // use multiselect plugin
  $(function(){
  $(".chzn-select").chosen();
  });
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.4.2/chosen.jquery.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.4.2/chosen.css">
</body>
</html>

